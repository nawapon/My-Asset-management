<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>User Dashboard | ระบบแจ้งซ่อม</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body class="hold-transition sidebar-mini user-page">
<div class="wrapper">

  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a></li></ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item"><span class="navbar-text mr-3" id="welcomeMessage"></span></li>
      <li class="nav-item"><button id="logoutButton" class="btn btn-danger btn-sm"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</button></li>
    </ul>
  </nav>

  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <a href="#" class="brand-link"><i class="fas fa-user-circle brand-image img-circle elevation-3" style="opacity: .8"></i><span class="brand-text font-weight-light">User Panel</span></a>
    <div class="sidebar">
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item">
            <a href="#" class="nav-link active" data-target="#equipment-view">
              <i class="nav-icon fas fa-database"></i>
              <p>ข้อมูลครุภัณฑ์</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-target="#repair-view">
              <i class="nav-icon fas fa-tools"></i>
              <p>แจ้งซ่อม / ประวัติ</p>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <div class="content-wrapper">
    <section class="content pt-3">
      <div class="container-fluid">

        <div id="equipment-view" class="content-section active">
          <div class="card card-primary card-outline">
            <div class="card-header">
              <h3 class="card-title">รายการครุภัณฑ์ทั้งหมด</h3>
              <div class="card-tools d-flex align-items-center">
                <form id="userSearchForm" class="d-inline-block">
                  <div class="input-group input-group-sm" style="width: 250px;">
                    <input type="text" id="userSearchInput" class="form-control float-right" placeholder="ค้นหาเลขครุภัณฑ์, ชื่อ...">
                    <div class="input-group-append">
                      <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                  </div>
                </form>
                <button type="button" id="userResetSearchBtn" class="btn btn-secondary btn-sm ml-2" style="display: none;"><i class="fas fa-times"></i> ล้างการค้นหา</button>
              </div>
            </div>
            <div class="card-body table-responsive p-0" style="height: 550px;">
              <table id="userEquipmentTable" class="table table-bordered table-head-fixed table-hover text-nowrap">
                <thead>
                  <tr>
                    <th>เลขครุภัณฑ์</th>
                    <th>ชื่ออุปกรณ์</th>
                    <th>สถานที่</th>
                    <th>สถานะ</th>
                    <th style="width: 120px;">รายละเอียด</th>
                  </tr>
                </thead>
                <tbody id="userEquipmentTableBody"></tbody>
              </table>
            </div>
            <div class="card-footer clearfix">
              <div id="userPaginationControls"></div>
            </div>
          </div>
        </div>

        <div id="repair-view" class="content-section">
            <div class="row">
                <div class="col-lg-5">
                    <div class="card card-primary card-outline">
                        <div class="card-header"><h3 class="card-title"><i class="fas fa-edit"></i> แจ้งซ่อมครุภัณฑ์</h3></div>
                        <form id="newRepairRequestForm">
                            <div class="card-body">
                                <div class="form-group"><label for="assetNumber">เลขครุภัณฑ์</label><input type="text" class="form-control" id="assetNumber" placeholder="พิมพ์เลขครุภัณฑ์เพื่อแจ้งซ่อม..." required></div>
                                <div id="equipmentDetails" class="callout callout-info" style="display: none;"><h id="equipmentName">ชื่ออุปกรณ์: -</h><p class="mb-0" id="equipmentLocation">สถานที่: -</p></div>
                                <div class="form-group">
                                    <label for="reporterLocation">สถานที่ / ที่ตั้ง ของผู้แจ้ง</label>
                                    <input type="text" class="form-control" id="reporterLocation" placeholder="เช่น อาคาร A ชั้น 2 ห้อง 204" required>
                                </div>
                                <div class="form-group">
                                    <label for="reporterContact">เบอร์ติดต่อ</label>
                                    <input type="text" class="form-control" id="reporterContact" placeholder="เบอร์โทรศัพท์มือถือ หรือเบอร์ภายใน" required>
                                </div>
                                <div class="form-group">
                                    <label for="problemDescription">รายละเอียดปัญหา</label>
                                    <textarea id="problemDescription" class="form-control" rows="4" placeholder="กรุณาอธิบายอาการที่พบ..." required></textarea>
                                </div>
                                <div id="formMessage" class="message mt-3"></div>
                            </div>
                            <div class="card-footer"><button type="submit" class="btn btn-primary">ส่งเรื่องแจ้งซ่อม</button></div>
                        </form>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="card card-info card-outline">
                        <div class="card-header"><h3 class="card-title"><i class="fas fa-history"></i> ประวัติการแจ้งซ่อมของฉัน</h3></div>
                        <div class="card-body table-responsive p-0" style="height: 400px;">
                            <table class="table table-bordered table-head-fixed table-hover text-nowrap">
                                <thead><tr><th>เลขครุภัณฑ์</th><th>รายละเอียดปัญหา</th><th>วันที่แจ้ง</th><th>สถานะ</th></tr></thead>
                                <tbody id="myRepairsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </section>
  </div>
</div>

<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title" id="detailsModalTitle"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>
            <div class="modal-body">
                <h6><i class="fas fa-info-circle"></i> รายละเอียดครุภัณฑ์</h6>
                <dl class="row details-dl">
                  <dt class="col-sm-3">เลขครุภัณฑ์:</dt><dd class="col-sm-9" id="detailsAssetNumber"></dd>
                  <dt class="col-sm-3">ชื่ออุปกรณ์:</dt><dd class="col-sm-9" id="detailsAssetName"></dd>
                  <dt class="col-sm-3">ประเภท:</dt><dd class="col-sm-9" id="detailsAssetType"></dd>
                  <dt class="col-sm-3">สถานที่:</dt><dd class="col-sm-9" id="detailsAssetLocation"></dd>
                  <dt class="col-sm-3">สถานะ:</dt><dd class="col-sm-9" id="detailsAssetStatus"></dd>
                </dl>
                <hr>
                <h6><i class="fas fa-history"></i> ประวัติการแจ้งซ่อม</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead>
                          <tr>
                            <th>วันที่แจ้ง</th>
                            <th>ผู้แจ้ง</th>
                            <th>ปัญหา</th>
                            <th>วันที่รับงาน</th>
                            <th>วันที่ซ่อมเสร็จ</th>
                            <th>สรุประยะเวลา</th>
                            <th>สถานะ</th>
                          </tr>
                        </thead>
                        <tbody id="detailsHistoryTableBody"></tbody>
                    </table>
                </div>
                <hr>
                <div id="detailsModalQrCode" class="qr-code-modal-container"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" id="repairNowBtn" data-toggle="modal" data-target="#repairNowModal" data-dismiss="modal"><i class="fas fa-wrench"></i> แจ้งซ่อมทันที</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ปิด</button>
            </div>
        </div>
    </div>
</div>
<!-- Repair Now Modal -->
<div class="modal fade" id="repairNowModal" tabindex="-1" role="dialog" aria-labelledby="repairNowModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="repairNowModalLabel">แจ้งซ่อมครุภัณฑ์</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <form id="repairNowForm">
                    <div class="form-group">
                        <label for="repairAssetNumber">เลขครุภัณฑ์</label>
                        <input type="text" class="form-control" id="repairAssetNumber">
                    </div>
                    <div class="form-group">
                        <label for="repairProblemDescription">รายละเอียดปัญหา</label>
                        <textarea class="form-control" id="repairProblemDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="repairReporterLocation">สถานที่/ห้อง</label>
                        <input type="text" class="form-control" id="repairReporterLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="repairReporterContact">เบอร์ติดต่อ</label>
                        <input type="text" class="form-control" id="repairReporterContact" required>
                    </div>
                    <div id="repairNowMessage" class="mt-2" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ยกเลิก</button>
                <button type="submit" form="repairNowForm" class="btn btn-primary"><i class="fas fa-paper-plane"></i> ส่งเรื่อง</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                <h4 class="modal-title" id="successModalLabel">แจ้งซ่อมสำเร็จ!</h4>
                <p>เจ้าหน้าที่จะดำเนินการตรวจสอบต่อไป</p>
                <button type="button" class="btn btn-success" data-dismiss="modal">ตกลง</button>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="app.js"></script>
</body>
</html>

